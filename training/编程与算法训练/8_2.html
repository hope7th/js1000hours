<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=<div>, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .cell {
        width: 100px;
        height: 100px;
        background-color: green;
        display: inline-block;
        border: solid 1px white;
        vertical-align: middle;
        line-height: 100px;
        font-size: 50px;
        text-align: center;
    }
</style>

<body>
    <div id="board"></div>
    <script>
        let color = 1;
        let pattern = [
            0, 0, 0,
            0,0, 0,
            0, 0, 0
        ]

        function show() {
            let board = document.getElementById("board");
            board.innerHTML = ""
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    let cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.innerText = pattern[i*3+j] == 2 ? "x" : pattern[i*3+j] == 1 ? "o" : ""
                    cell.addEventListener("click", () => move(j, i));

                    //??? var 不能这样写，为什么呢，j,i保存不下来???

                    board.appendChild(cell);
                }
                board.appendChild(document.createElement("br"))
            }

        }

        function move(x, y) {
            pattern[y*3+x] = color;
            if (check(pattern,color)) {
                alert(color == 2 ? "x is winner" : " o is winner");
            }
            color = 3 - color;
            console.log(bestChoice(pattern,color));
            show()
            if(willWin(pattern,color)){
                console.log(color==2?"x will win":"o will win!");
            }
        }

        function clone(pattern){
            return Object.create(pattern)
        }

        function check(pattern,color) {
            for (let i = 0; i < 3; i++) {
                let win = true;
                for (let j = 0; j < 3; j++) {
                    if (pattern[i*3+j] !== color) {
                        win = false;
                    }
                }
                if (win) {
                    return true;
                }
            }

            for (let i = 0; i < 3; i++) {
                let win = true;
                for (let j = 0; j < 3; j++) {
                    if (pattern[j*3+i] !== color) {
                        win = false;
                    }
                }
                if (win) {
                    return true;
                }
            } {
                let win = true;
                for (let j = 0; j < 3; j++) {
                    if (pattern[j*3+2 - j] !== color) {
                        win = false;
                    }
                }
                if (win) {
                    return true
                }
            } {
                let win = true;
                for (let j = 0; j < 3; j++) {
                    if (pattern[j*3+j] !== color) {
                        win = false;
                    }
                }
                if (win) {
                    return true
                }
            }
        }

        function willWin(pattern,color){
            for(let i=0;i<3;i++){
                for(let j=0;j<3;j++){
                    if(pattern[i][j])
                        continue
                    let tmp = clone(pattern);
                    tmp[i][j] = color;
                    if(check(tmp,color)){
                        return [j,i];
                    } 
                }
            }
            return null;
        }
        function bestChoice(pattern,color){
            let p;
            if(p = willWin(pattern,color)){
                return {
                    point:p,
                    result:1
                }
            }
            let result = -2;
            let point = null;
            outer:for(let i = 0;i<3;i++){
                for(let j=0;j<3;j++){
                    if(pattern[i][j]){
                        continue
                    }
                    let tmp  = clone(pattern);
                    tmp[i*3+j] = color;
                    let r = bestChoice(tmp,3-color).result;
                    if(-r>result){
                        result = -r;
                        point = [j,i];
                    }
                    if(result==1){
                        break outer;
                    }

                }
            }
            return {
                point:point,
                result:point?result:0
            }
        }
        show(pattern);
        console.log(bestChoice(pattern,color))
    </script>
</body>

</html>